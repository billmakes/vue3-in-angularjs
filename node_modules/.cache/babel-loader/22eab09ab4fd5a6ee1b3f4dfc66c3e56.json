{"remainingRequest":"/home/bill/tmp/vang/node_modules/babel-loader/lib/index.js!/home/bill/tmp/vang/node_modules/eslint-loader/index.js??ref--14-0!/home/bill/tmp/vang/src/ng-vue-directive.js","dependencies":[{"path":"/home/bill/tmp/vang/src/ng-vue-directive.js","mtime":1670029980350},{"path":"/home/bill/tmp/vang/node_modules/cache-loader/dist/cjs.js","mtime":1669049762880},{"path":"/home/bill/tmp/vang/node_modules/babel-loader/lib/index.js","mtime":1667853256770},{"path":"/home/bill/tmp/vang/node_modules/eslint-loader/index.js","mtime":1669953087015}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIAogKiBBbmd1bGFySnMgZGlyZWN0aXZlIHRvIHJlbmRlciBWdWUgY29tcG9uZW50IGluc2lkZSBBbmd1bGFySnMgY29kZSB3aXRob3V0IGV4dHJhIGJpbmRpbmcKICogSXQgc3VwcG9ydHMgb25lLXRpbWUgYmluZGluZyhub3Qgb25lLXdheSBiaW5kaW5nKSBmcm9tIHRoZSBnaXZlbiBodG1sIGF0dHJpYnV0ZXMKICogCiAqIEhvdyBkb2VzIGl0IHdvcms/CiAqICAgMS4gUmVhZCB0aGUgZWxlbWVudCBuYW1lLCBhbmQgdXNlIGl0IHRvIGZpbmQgYSBWdWUgY29tcG9uZW50IGZyb20gYSBrZXkvdmFsdWUgcmVnaXN0cnkKICogICAyLiBHZXQgYXR0cmlidXRlcywgYW5kIHVzZSBpdCB0byB0aGlzIGVsZW1lbnQgc2NvcGUKICogICAzLiBVc2luZyB0aGUgZWxlbWVudCBuYW1lIGFuZCBhdHRyaWJ1dGVzLCBpbml0aWFsaXplIGEgdnVlIGNvbXBvbmVudCB0byB0aGlzIGVsZW1lbnQKICogCiAqIFJlZmVyZW5jZXMKICogIC4gaHR0cHM6Ly92My52dWVqcy5vcmcvZ3VpZGUvY29tcG9uZW50LWJhc2ljcy5odG1sI2R5bmFtaWMtY29tcG9uZW50cwogKiAgLiBodHRwczovL3YzLnZ1ZWpzLm9yZy9ndWlkZS9pbnN0YW5jZS5odG1sI3RoZS1yb290LWNvbXBvbmVudAogKiAgLiBodHRwczovL2RvY3MuYW5ndWxhcmpzLm9yZy9ndWlkZS9kaXJlY3RpdmUKICogCiAqLwppbXBvcnQgKiBhcyBWdWUgZnJvbSAndnVlJzsKaW1wb3J0IE15VnVlQ29tcG9uZW50IGZyb20gJy4vbXktdnVlLWNvbXBvbmVudC52dWUnOwppbXBvcnQgTXlPdGhlclZ1ZUNvbXBvbmVudCBmcm9tICcuL215LW90aGVyLXZ1ZS1jb21wb25lbnQudnVlJzsKCi8vIFZ1ZSBjb21vbmVudCByZWdpc3RyeQpjb25zdCBWVUVfQ09NUE9ORU5UUyA9IHsKICBNeVZ1ZUNvbXBvbmVudCwKICBNeU90aGVyVnVlQ29tcG9uZW50Cn07CgovLyBCdWlsZCBhIGR5bmFtaWMgc2NvcGUgZm9yIGNvbXBpbGUKLy8gV29ya3Mgd2l0aCBmb289InNjb3BlVmFyIiBiYXI9IiRjdHJsLmN0cmxWYXIiIGJhej0iJ1NUUklORyciIGZvby1iYXI9IiIgbmctdnVlCmZ1bmN0aW9uIGdldEFuZ3VsYXJTY29wZUZyb21BdHRycyhzY29wZSwgYXR0cnMpIHsKICBjb25zdCBleGNsdWRlcyA9IFsnbmFtZScsICdjbGFzcyddOwogIGNvbnN0IG5ld1Njb3BlID0ge307CiAgZm9yIChsZXQga2V5IGluIGF0dHJzLiRhdHRyKSB7CiAgICBpZiAoZXhjbHVkZXMuaW5jbHVkZXMoa2V5KSkgY29udGludWU7IC8vIHNraXAgY29tbW9uIGF0dHJpYnV0ZXMKICAgIGNvbnN0IG5nRXhwciA9IGF0dHJzW2tleV0ubWF0Y2goL14oW147XSopOz8vKVsxXTsgLy8gNCBzZWN1cml0eSwgZS5nLiwgJyRjdHJsLmZvbzthdHRhY2soKScKICAgIGlmIChuZ0V4cHIubWF0Y2goL14nLionJC8pKSB7CiAgICAgIC8vIHN0cmluZyBleHByZXNzaW9uLiBlLmcuIGJhej0iJ2hlbGxvJyIKICAgICAgY29uc29sZS5sb2coJ3N0cmluZyBleHByZXNzaW9uJywgewogICAgICAgIGtleSwKICAgICAgICBuZ0V4cHIKICAgICAgfSk7CiAgICAgIG5ld1Njb3BlW2tleV0gPSBldmFsKGB7bmdFeHByfWApOwogICAgfSBlbHNlIGlmIChrZXkubWF0Y2goL15uZ1tBLVpdLykpIHsvLyBhbmd1bGFySnMgZXZlbnRzIG9yIGFuZ3VsYXJKcyBhdHRyaWJ1dGVzCiAgICB9IGVsc2UgaWYgKGtleS5tYXRjaCgvXnZPbltBLVpdLykpIHsvLyB2dWUgZXZlbnRzCiAgICB9IGVsc2UgaWYgKG5nRXhwcikgewogICAgICAvLyBpZ25vcmUgZW1wdHkgYXR0cmlidXRlCiAgICAgIGNvbnNvbGUubG9nKCdhbmd1bGFyIGV4cHJlc3Npb24nLCB7CiAgICAgICAga2V5LAogICAgICAgIG5nRXhwcgogICAgICB9LCBzY29wZS4kcGFyZW50KTsKICAgICAgbmV3U2NvcGVba2V5XSA9IGV2YWwoYHNjb3BlLiR7bmdFeHByfWApOwogICAgfQogIH0KICByZXR1cm4gbmV3U2NvcGU7Cn0KZnVuY3Rpb24gZ2V0VnVlRXZlbnRBdHRycyhhdHRycykgewogIHJldHVybiBPYmplY3Qua2V5cyhhdHRycy4kYXR0cikuZmlsdGVyKGVsID0+IGVsLm1hdGNoKC9edk9uW0EtWl0vKSkubWFwKGtleSA9PiB7CiAgICBjb25zdCBhdHRyTmFtZSA9IGF0dHJzLiRhdHRyW2tleV0ucmVwbGFjZSgvdi1vbjovLCAnJyk7CiAgICBjb25zdCBleHByID0gYXR0cnNba2V5XTsKICAgIHJldHVybiBgdi1vbjoke2F0dHJOYW1lfT0iaGFuZGxlRXZlbnRzKCRldmVudCwgJyR7YXR0ck5hbWV9JywgJyR7ZXhwcn0nKSJgOwogIH0pOwp9CmZ1bmN0aW9uIGdldFZ1ZUNvbXBvbmVudCh0YWdOYW1lLCBWVUVfQ09NUE9ORU5UUykgewogIGNvbnN0IFtfLCBjb21wb25lbnRdID0gT2JqZWN0LmVudHJpZXMoVlVFX0NPTVBPTkVOVFMpLmZpbmQoKFtrZXksIHZhbHVlXSkgPT4gewogICAgcmV0dXJuIGtleS50b0xvd2VyQ2FzZSgpID09PSB0YWdOYW1lLnJlcGxhY2UoLy0vZyk7CiAgfSk7CiAgcmV0dXJuIGNvbXBvbmVudDsKfQoKLy8gd2h5IGRpcmVjdGl2ZT8gQmVjYXVzZSBjb21wb25lbnQgY2FuJ3QgYmUgdXNlZCB3aXRoIGF0dHJpYnV0ZQpjb25zdCBOZ1Z1ZURpcmVjdGl2ZSA9IGZ1bmN0aW9uICgkY29tcGlsZSwgJHBhcnNlKSB7CiAgcmV0dXJuIHsKICAgIGNvbXBpbGU6IGZ1bmN0aW9uIChlbGVtZW50LCBhdHRycykgewogICAgICBjb25zdCB0YWdOYW1lID0gZWxlbWVudFswXS50YWdOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgIGNvbnN0IHZ1ZUNvbXBvbmVudCA9IGdldFZ1ZUNvbXBvbmVudCh0YWdOYW1lLCBWVUVfQ09NUE9ORU5UUyk7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsLCB0cmFuc2NsKSB7CiAgICAgICAgY29uc3QgbmV3U2NvcGUgPSBnZXRBbmd1bGFyU2NvcGVGcm9tQXR0cnMoc2NvcGUsIGF0dHJzKTsKICAgICAgICBmb3IgKGxldCBrZXkgaW4gbmV3U2NvcGUpIHsKICAgICAgICAgIHNjb3BlW2tleV0gPSBuZXdTY29wZVtrZXldOwogICAgICAgIH0KCiAgICAgICAgLy8gSW5zZXJ0IGEgVnVlIGNvbXBvbmVudCB0byB0aGlzIGVsZW1lbnQKICAgICAgICBjb25zdCB2dWVFdmVudEF0dHJzID0gZ2V0VnVlRXZlbnRBdHRycyhhdHRycykuam9pbignICcpOwogICAgICAgIGNvbnN0IHZ1ZVByb3BzQXR0cnMgPSBPYmplY3Qua2V5cyhuZXdTY29wZSkubWFwKGtleSA9PiBgdi1iaW5kOiR7a2V5fT0iJHtrZXl9ImApLmpvaW4oJyAnKTsKICAgICAgICBlbGVtZW50WzBdLmlubmVySFRNTCA9IGA8JHt0YWdOYW1lfSAke3Z1ZVByb3BzQXR0cnN9ICR7dnVlRXZlbnRBdHRyc30+PC8ke3RhZ05hbWV9PmA7CiAgICAgICAgY29uc3QgYXBwID0gVnVlLmNyZWF0ZUFwcCh7CiAgICAgICAgICBkYXRhOiBfID0+IG5ld1Njb3BlLAogICAgICAgICAgbWV0aG9kczogewogICAgICAgICAgICBoYW5kbGVFdmVudHM6ICgkZXZlbnQsIGV2ZW50TmFtZSwgZXhwcikgPT4gewogICAgICAgICAgICAgIGNvbnN0IG5nRXhwciA9IGV4cHIubWF0Y2goL14oW147XSopOz8vKVsxXTsgLy8gNCBzZWN1cml0eSwgZS5nLiwgJyRjdHJsLmZvbzthdHRhY2soKScKICAgICAgICAgICAgICBldmFsKGBzY29wZS4ke25nRXhwcn1gKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGFwcC5jb21wb25lbnQodGFnTmFtZSwgdnVlQ29tcG9uZW50KTsgLy8gRGVmaW5lIFZ1ZSBjb21wb25lbnQgZ2l2ZW4gZnJvbSBhdHRyaWJ1dGUKICAgICAgICBhcHAubW91bnQoZWxlbWVudFswXSk7IC8vIFZ1ZWlmeSB0aGlzIGVsZW1lbnQKICAgICAgfTsKICAgIH0KICB9Owp9OwoKZXhwb3J0IGRlZmF1bHQgTmdWdWVEaXJlY3RpdmU7"},{"version":3,"names":["Vue","MyVueComponent","MyOtherVueComponent","VUE_COMPONENTS","getAngularScopeFromAttrs","scope","attrs","excludes","newScope","key","$attr","includes","ngExpr","match","console","log","eval","$parent","getVueEventAttrs","Object","keys","filter","el","map","attrName","replace","expr","getVueComponent","tagName","_","component","entries","find","value","toLowerCase","NgVueDirective","$compile","$parse","compile","element","vueComponent","ctrl","transcl","vueEventAttrs","join","vuePropsAttrs","innerHTML","app","createApp","data","methods","handleEvents","$event","eventName","mount"],"sources":["/home/bill/tmp/vang/src/ng-vue-directive.js"],"sourcesContent":["/**\n * \n * AngularJs directive to render Vue component inside AngularJs code without extra binding\n * It supports one-time binding(not one-way binding) from the given html attributes\n * \n * How does it work?\n *   1. Read the element name, and use it to find a Vue component from a key/value registry\n *   2. Get attributes, and use it to this element scope\n *   3. Using the element name and attributes, initialize a vue component to this element\n * \n * References\n *  . https://v3.vuejs.org/guide/component-basics.html#dynamic-components\n *  . https://v3.vuejs.org/guide/instance.html#the-root-component\n *  . https://docs.angularjs.org/guide/directive\n * \n */\nimport * as Vue from 'vue';\nimport MyVueComponent from './my-vue-component.vue';\nimport MyOtherVueComponent from './my-other-vue-component.vue';\n\n// Vue comonent registry\nconst VUE_COMPONENTS = {\n  MyVueComponent, MyOtherVueComponent\n}\n\n// Build a dynamic scope for compile\n// Works with foo=\"scopeVar\" bar=\"$ctrl.ctrlVar\" baz=\"'STRING'\" foo-bar=\"\" ng-vue\nfunction getAngularScopeFromAttrs(scope, attrs) {\n  const excludes = ['name', 'class'];\n  const newScope = {};\n  for (let key in attrs.$attr) {\n    if (excludes.includes(key)) continue; // skip common attributes\n    const ngExpr = attrs[key].match(/^([^;]*);?/)[1]; // 4 security, e.g., '$ctrl.foo;attack()'\n    if (ngExpr.match(/^'.*'$/)) { // string expression. e.g. baz=\"'hello'\"\n      console.log('string expression', { key, ngExpr })\n      newScope[key] = eval(`{ngExpr}`);\n    } else if (key.match(/^ng[A-Z]/)) { // angularJs events or angularJs attributes\n    } else if (key.match(/^vOn[A-Z]/)) { // vue events\n    } else if (ngExpr) { // ignore empty attribute\n      console.log('angular expression', { key, ngExpr }, scope.$parent)\n      newScope[key] = eval(`scope.${ngExpr}`);\n    }\n  }\n  return newScope;\n}\n\nfunction getVueEventAttrs(attrs) {\n  return Object.keys(attrs.$attr).filter(el => el.match(/^vOn[A-Z]/))\n    .map(key => {\n      const attrName = attrs.$attr[key].replace(/v-on:/, '');\n      const expr = attrs[key];\n      return `v-on:${attrName}=\"handleEvents($event, '${attrName}', '${expr}')\"`;\n    });\n}\n\nfunction getVueComponent(tagName, VUE_COMPONENTS) {\n  const [_, component] = Object.entries(VUE_COMPONENTS).find(([key, value]) => {\n    return (key.toLowerCase() === tagName.replace(/-/g,));\n  });\n\n  return component;\n}\n\n// why directive? Because component can't be used with attribute\nconst NgVueDirective = function($compile, $parse) {\n  return {\n    compile: function(element, attrs) {\n      const tagName = element[0].tagName.toLowerCase();\n      const vueComponent = getVueComponent(tagName, VUE_COMPONENTS);\n\n      return function(scope, element, attrs, ctrl, transcl) {\n        const newScope = getAngularScopeFromAttrs(scope, attrs);\n        for (let key in newScope) {\n          scope[key] = newScope[key];\n        }\n\n        // Insert a Vue component to this element\n        const vueEventAttrs = getVueEventAttrs(attrs).join(' ');\n        const vuePropsAttrs = Object.keys(newScope).map(key => `v-bind:${key}=\"${key}\"`).join(' ');\n        element[0].innerHTML = `<${tagName} ${vuePropsAttrs} ${vueEventAttrs}></${tagName}>`;\n        const app = Vue.createApp({\n          data: _ => newScope,\n          methods: {\n            handleEvents: ($event, eventName, expr) => {\n              const ngExpr = expr.match(/^([^;]*);?/)[1]; // 4 security, e.g., '$ctrl.foo;attack()'\n              eval(`scope.${ngExpr}`);\n            }\n          }\n        });\n        app.component(tagName, vueComponent);  // Define Vue component given from attribute\n        app.mount(element[0]); // Vueify this element\n      }\n    }\n  };\n};\n\nexport default NgVueDirective;\n"],"mappings":"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"}]}